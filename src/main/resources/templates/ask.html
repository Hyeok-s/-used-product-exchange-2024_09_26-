<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org" xmlns="http://www.w3.org/1999/html">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Google Fonts -->
  <link href='http://fonts.googleapis.com/css?family=Titillium+Web:400,200,300,700,600' rel='stylesheet' type='text/css'>
  <link href='http://fonts.googleapis.com/css?family=Roboto+Condensed:400,700,300' rel='stylesheet' type='text/css'>
  <link href='http://fonts.googleapis.com/css?family=Raleway:400,100' rel='stylesheet' type='text/css'>

  <!-- Bootstrap -->
  <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css">

  <!-- Font Awesome -->
  <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">

  <!-- css -->
  <link rel="stylesheet" href="/css/style.css">
  <script src="http://code.jquery.com/jquery-1.11.2.min.js"></script>
  <style>
    .details {
      display: none;
      background-color: #f9f9f9;
      border-top: 1px solid #ddd;
    }
  </style>
</head>
<body>
<!-- 상단 바 -->
<div class="header-area">
  <div class="container">
    <div class="row">
      <div class="col-md-8">
        <div class="user-menu">
          <ul>
            <!-- 로그인 여부에 따라 다른 버튼 표시 -->
            <li th:if="${session.loggedInUser == null}">
              <a href="/demo/login"><i class="fa fa-user"></i>로그인</a>
            </li>
            <li th:if="${session.loggedInUser == null}">
              <a href="/demo/signup"><i class="fa fa-heart"></i>회원가입</a>
            </li>
            <li th:if="${session.loggedInUser != null}">
              <a href="/demo/mypage"><i class="fa fa-user"></i>마이페이지</a>
            </li>
            <li th:if="${session.loggedInUser != null}">
              <a href="/demo/logout"><i class="fa fa-user"></i>로그아웃</a>
            </li>
            <li th:if="${session.loggedInUser != null and session.loggedInUser.memberRole == 'admin'}">
              <a href="/Admin/admin"><i class="fa fa-user"></i>관리자페이지</a>
            </li>
          </ul>
        </div>
      </div>
    </div>
  </div>
</div>
<!-- 상단 밑 사진 등 바 -->
<div class="site-branding-area">
  <div class="container">
    <div class="row">
      <div class="col-sm-6">
        <div class="logo">
          <h1><a href="/">T<span>est</span></a></h1>
        </div>
      </div>
      <div class="col-sm-6">
        <div class="shopping-item">
          <a href="/product/upload"><i class="fa fa-pencil-square-o">-upload</i> <span class="product-count">0</span></a>
        </div>
      </div>
    </div>
  </div>
</div>
<!-- 네비게이션 바 -->
<div class="mainmenu-area">
  <div class="container">
    <div class="row">
      <div class="navbar-collapse collapse">
        <ul class="nav navbar-nav">
          <li><a href="/">상품확인</a></li>
          <li><a href="/product/heart">내찜상품</a></li>
          <li><a href="/ask">문의하기</a></li>
          <li><a href="#">도움말</a></li>
        </ul>
      </div>
    </div>
  </div>
</div>

<table>
  <thead>
  <tr>
    <th>제목</th>
    <th>작성일</th>
    <th>답변 여부</th>
    <th>보기</th>
  </tr>
  </thead>
  <tbody>
  <tr th:each="ask : ${asks}" th:data-askid="${ask.id}">
    <td th:text="${ask.aTitle}"></td>
    <td th:text="${ask.aTime}"></td>
    <td th:text="${ask.answers ? '답변완료' : '답변전'}"></td>
    <td>
      <button type="button" th:if="${ask.answers}"
              th:onclick="'fetchAnswerDetails(' + ${ask.id} + ')'">보기</button>
    </td>
  </tr>
  <tr th:each="ask : ${asks}" th:attr="id=${'answer-' + ask.id}"
      class="answer-row" style="display:none;">
    <td colspan="4">
      <div><strong>답변 내용:</strong> <span class="answer-content"></span></div>
    </td>
  </tr>
  </tbody>
</table>

<h1>문의하기</h1>
<form th:action="@{/ask/submit}" th:object="${askDTO}" method="post">
  <label for="aTitle">제목:</label>
  <input type="text" id="aTitle" th:field="*{aTitle}" required>
  <br>

  <label for="aContent">내용:</label>
  <textarea id="aContent" th:field="*{aContent}" required></textarea>
  <br>

  <button type="submit">제출</button>
</form>

<script th:inline="javascript">
  function fetchAnswerDetails(askId) {
  const existingAnswerRow = document.getElementById(`answer-${askId}`);

  if (existingAnswerRow) {
    // 이미 답변이 열려 있다면 숨기기
    existingAnswerRow.remove();
  } else {
    // fetch 요청을 통해 답변 데이터를 가져오기
    fetch(`/admin/answer/${askId}`)
      .then(response => response.json())
      .then(data => {
        const answerText = data && data.areturn ? data.areturn : '답변이 없습니다.';

        // 새로운 tr 요소를 동적으로 생성하여 답변 내용을 추가
        const answerRow = document.createElement('tr');
        answerRow.id = `answer-${askId}`;
        answerRow.className = 'answer-row';
        answerRow.innerHTML = `
          <td colspan="4">
            <div><strong>답변 내용:</strong> <span>${answerText}</span></div>
          </td>
        `;

        // 클릭된 질문 행 바로 아래에 답변 행 삽입
        const askRow = document.querySelector(`tr[data-askid="${askId}"]`);
        askRow.parentNode.insertBefore(answerRow, askRow.nextSibling);
      })
      .catch(error => console.error('Error:', error));
  }
}

</script>



</body>
</html>